(()=>{var e={};e.id=73,e.ids=[73],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},8188:e=>{"use strict";e.exports=require("module")},7310:e=>{"use strict";e.exports=require("url")},9489:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>g,pages:()=>c,routeModule:()=>m,tree:()=>o});var r=a(7096),l=a(6132),s=a(7284),i=a.n(s),n=a(2564),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);a.d(t,d);let o=["",{children:["customize",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,5438)),"C:\\Users\\prana\\CascadeProjects\\template-creator\\app\\customize\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,5345)),"C:\\Users\\prana\\CascadeProjects\\template-creator\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\prana\\CascadeProjects\\template-creator\\app\\customize\\[id]\\page.tsx"],g="/customize/[id]/page",h={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/customize/[id]/page",pathname:"/customize/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},558:(e,t,a)=>{Promise.resolve().then(a.bind(a,5938))},5938:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>CustomizePage});var r=a(784),l=a(9885),s=a(7114),i=a(9803),n=a(9546),d=a(5574),o=a(1910),c=a(1922),g=a(1440),h=a.n(g),m=a(9396),p=a(8335);function CustomizePage(){let e=(0,s.useParams)(),[t,a]=(0,l.useState)(null),[g,u]=(0,l.useState)({}),[x,f]=(0,l.useState)(!0),[b,y]=(0,l.useState)(!1),[w,P]=(0,l.useState)(0),[j,v]=(0,l.useState)([]),[N,C]=(0,l.useState)(null),[F,k]=(0,l.useState)(null),[D,E]=(0,l.useState)(!1),[T,S]=(0,l.useState)(null),L=(0,l.useRef)(null);(0,l.useEffect)(()=>{let loadPdfLibraries=async()=>{try{let e=document.createElement("script");e.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",e.onload=()=>{k(window.PDFLib)},document.head.appendChild(e);let t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",t.onload=()=>{window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"},document.head.appendChild(t)}catch(e){console.error("Error loading PDF libraries:",e)}};loadPdfLibraries()},[]),(0,l.useEffect)(()=>{e.id&&fetchTemplate(e.id)},[e.id]),(0,l.useEffect)(()=>{let handleKeyDown=e=>{t?.isPdf&&("ArrowLeft"===e.key||"ArrowUp"===e.key?(e.preventDefault(),navigateToPage("prev")):("ArrowRight"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),navigateToPage("next")))};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[t,w]);let fetchTemplate=async e=>{try{f(!0);let t=await fetch(`/api/templates/${e}`);if(t.ok){let e=await t.json();a(e);let r={};e.placeholders.forEach(e=>{r[e.id]=""}),u(r),e.isPdf&&e.pdfFilePath?await loadPdfTemplate(e.pdfFilePath):e.isPdf&&!e.pdfFilePath&&(console.warn("PDF template detected but no pdfFilePath provided"),S("PDF file path not found in template data"))}else throw Error("Template not found")}catch(e){console.error("Error fetching template:",e)}finally{f(!1)}},loadPdfTemplate=async e=>{if(!F){console.warn("PDF-lib not loaded yet, retrying..."),setTimeout(()=>loadPdfTemplate(e),1e3);return}try{E(!0),S(null),console.log("Loading PDF from:",e);let r=await fetch(e,{mode:"cors",headers:{Accept:"application/pdf"}});if(!r.ok)throw Error(`Failed to fetch PDF: ${r.status} ${r.statusText}`);let l=await r.arrayBuffer();console.log("PDF loaded, size:",l.byteLength);let s=await F.PDFDocument.load(l),i=s.getPageCount();console.log("PDF pages detected:",i),C(s),t&&(!t.totalPages||t.totalPages!==i)&&a(e=>e?{...e,totalPages:i}:null);let n=[];for(let e=0;e<i;e++)try{console.log(`Rendering page ${e+1}/${i}`);let t=await renderPdfPage(s,e);t?(n.push(t),console.log(`Page ${e+1} rendered successfully`)):(console.warn(`Page ${e+1} failed to render`),n.push(""))}catch(t){console.error(`Error rendering page ${e+1}:`,t),n.push("")}console.log("Total pages rendered:",n.filter(e=>e).length),v(n),P(0),E(!1)}catch(e){console.error("Error loading PDF template:",e),S(`Failed to load PDF template: ${e instanceof Error?e.message:"Unknown error"}`),E(!1)}},renderPdfPage=async(e,t)=>{if(!F||!e)return"";try{if(window.pdfjsLib||(console.warn("PDF.js not loaded, waiting..."),await new Promise(e=>setTimeout(e,1e3))),window.pdfjsLib){let a=await e.save(),r=window.pdfjsLib.getDocument({data:a,cMapUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/",cMapPacked:!0}),l=await r.promise,s=await l.getPage(t+1),i=Math.min(2,800/s.getViewport({scale:1}).width),n=s.getViewport({scale:i}),d=document.createElement("canvas"),o=d.getContext("2d");if(!o)throw Error("Canvas context not available");return d.height=n.height,d.width=n.width,await s.render({canvasContext:o,viewport:n,enableWebGL:!1}).promise,l.destroy(),d.toDataURL("image/png",.9)}{console.warn("PDF.js not available, using fallback");let a=await F.PDFDocument.create(),[r]=await a.copyPages(e,[t]);a.addPage(r);let l=await a.save(),s=new Blob([l],{type:"application/pdf"});return URL.createObjectURL(s)}}catch(e){return console.error("Error rendering PDF page:",e),""}},handleInputChange=(e,t)=>{u(a=>({...a,[e]:t}))},handleImageUpload=(e,t)=>{u(a=>({...a,[e]:t}))},navigateToPage=e=>{if(!t||!t.isPdf)return;let a=t.totalPages||j.length||1;"prev"===e&&w>0?P(w-1):"next"===e&&w<a-1&&P(w+1)},goToPage=e=>{if(!t||!t.isPdf)return;let a=t.totalPages||j.length||1;P(Math.max(0,Math.min(e-1,a-1)))},generatePDF=async()=>{if(t){y(!0);try{t.isPdf&&N?await generatePdfFromTemplate():await generatePdfFromCanvas()}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please try again.")}finally{y(!1)}}},generatePdfFromTemplate=async()=>{if(F&&N&&t)try{let e=await F.PDFDocument.create(),a=await e.copyPages(N,Array.from({length:N.getPageCount()},(e,t)=>t));a.forEach(t=>e.addPage(t));let r=await e.embedFont(F.StandardFonts.Helvetica),l=await e.embedFont(F.StandardFonts.TimesRoman),s={Arial:r,Helvetica:r,"Times New Roman":l,Georgia:l},i=e.getPages(),n={};for(let a of t.placeholders)if("image"===a.type&&g[a.id]instanceof File){let t=g[a.id];try{let r;let l=await t.arrayBuffer();if("image/png"===t.type)r=await e.embedPng(l);else if("image/jpeg"===t.type||"image/jpg"===t.type)r=await e.embedJpg(l);else{console.warn(`Unsupported image type: ${t.type}`);continue}n[a.id]=r}catch(e){console.error("Error embedding image:",e)}}for(let e=0;e<i.length;e++){let a=i[e],l=t.placeholders.filter(t=>t.pageIndex===e||t.isGlobal);for(let t of l){let l={...t};if(t.isGlobal&&t.pageOverrides&&t.pageOverrides[e]){let a=t.pageOverrides[e];l={...t,...a}}let i=g[t.id];if(!i&&t.required){alert(`Required field "${t.placeholder}" is missing on page ${e+1}`);return}if(i){if("text"===t.type||"textarea"===t.type){let e=s[t.fontFamily||"Arial"]||r,n=t.fontSize||12,d=hexToRgb(t.color||"#000000"),o=a.getSize(),c=o.height,g=l.x,h=c-l.y-l.height;if("textarea"===t.type){let r=i.toString().split("\n"),s=(t.lineHeight||1.2)*n,o=t.maxLines||5,c=h+t.height-s;for(let t=0;t<Math.min(r.length,o);t++){if(r[t].trim()){let s=l.width-16,i=e.widthOfTextAtSize(r[t],n),o=g+8+(s-Math.min(i,s))/2;a.drawText(r[t],{x:o,y:c,size:n,font:e,color:F.rgb(d.r/255,d.g/255,d.b/255),maxWidth:s})}c-=s}}else{let t=l.width-16,r=e.widthOfTextAtSize(i.toString(),n),s=g+8+(t-Math.min(r,t))/2;a.drawText(i.toString(),{x:s,y:h+4,size:n,font:e,color:F.rgb(d.r/255,d.g/255,d.b/255),maxWidth:t})}}else if("image"===t.type&&n[t.id]){let e=n[t.id],r=a.getSize();r.width;let s=r.height,i=l.x,d=s-l.y-l.height,o=e.scale(1),c=o.width/o.height,g=l.width/l.height,h=l.width,m=l.height,p=i,u=d;c>g?(m=l.width/c,u=d+(l.height-m)/2):(h=l.height*c,p=i+(l.width-h)/2),a.drawImage(e,{x:p,y:u,width:h,height:m})}}}}let d=await e.save(),o=new Blob([d],{type:"application/pdf"}),c=URL.createObjectURL(o),h=document.createElement("a");h.href=c,h.download=`${t.name}-customized.pdf`,h.click(),URL.revokeObjectURL(c)}catch(e){throw console.error("Error generating PDF from template:",e),e}},generatePdfFromCanvas=async()=>{if(!L.current||!t)return;let e=L.current.querySelectorAll('[data-placeholder-border="true"]');e.forEach(e=>{e.style.border="none",e.style.backgroundColor="transparent"});let a=await (0,m.Z)(L.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});e.forEach(e=>{e.style.border="2px dashed #60a5fa",e.style.backgroundColor="rgba(219, 234, 254, 0.3)"});let r=a.toDataURL("image/png"),l=new p.ZP({orientation:t.width>t.height?"landscape":"portrait",unit:"px",format:[t.width,t.height]});l.addImage(r,"PNG",0,0,t.width,t.height),l.save(`${t.name}-customized.pdf`)},downloadImage=async()=>{if(L.current){y(!0);try{let e=L.current.querySelectorAll('[data-placeholder-border="true"]');e.forEach(e=>{e.style.border="none",e.style.backgroundColor="transparent"});let a=await (0,m.Z)(L.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});e.forEach(e=>{e.style.border="2px dashed #60a5fa",e.style.backgroundColor="rgba(219, 234, 254, 0.3)"});let r=document.createElement("a");r.download=`${t?.name}-customized.png`,r.href=a.toDataURL(),r.click()}catch(e){console.error("Error generating image:",e),alert("Error generating image. Please try again.")}finally{y(!1)}}},hexToRgb=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},getCurrentPagePlaceholders=()=>t?t.isPdf?t.placeholders.filter(e=>e.pageIndex===w||e.isGlobal):t.placeholders:[],getGlobalPlaceholders=()=>t?t.placeholders.filter(e=>e.isGlobal):[],getPageSpecificPlaceholders=()=>t?t.isPdf?t.placeholders.filter(e=>e.pageIndex===w&&!e.isGlobal):t.placeholders.filter(e=>!e.isGlobal):[],getCurrentBackgroundImage=()=>t?.isPdf&&j[w]?j[w]:t?.backgroundImage||"";return x?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading template..."})]})}):t?r.jsx("div",{className:"min-h-screen bg-gray-50 text-black",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(h(),{href:"/",className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:r.jsx(i.Z,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mr-3",children:t.name}),t.isPdf&&(0,r.jsxs)("div",{className:"flex items-center bg-blue-50 px-2 py-1 rounded-md",children:[r.jsx(n.Z,{className:"w-4 h-4 text-blue-600 mr-1"}),r.jsx("span",{className:"text-sm text-blue-600",children:"PDF Template"})]})]}),r.jsx("p",{className:"text-gray-600",children:t.description}),t.isPdf&&(0,r.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:[Math.max(t.totalPages||0,j.length)," pages • Current: Page ",w+1]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[!t.isPdf&&(0,r.jsxs)("button",{onClick:downloadImage,disabled:b,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50",children:[r.jsx(d.Z,{className:"w-4 h-4 mr-2"}),b?"Generating...":"Download PNG"]}),(0,r.jsxs)("button",{onClick:generatePDF,disabled:b,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center disabled:opacity-50",children:[r.jsx(d.Z,{className:"w-4 h-4 mr-2"}),b?"Generating...":"Download PDF"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Customize Your Template"}),t.isPdf&&(j.length>1||t.totalPages&&t.totalPages>1)&&r.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Navigate Pages"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>navigateToPage("prev"),disabled:0===w,className:"p-2 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Page",children:r.jsx(o.Z,{className:"w-5 h-5"})}),(0,r.jsxs)("span",{className:"text-sm text-gray-600 px-2",children:["Page ",w+1," of ",Math.max(t.totalPages||0,j.length)]}),r.jsx("button",{onClick:()=>navigateToPage("next"),disabled:w>=Math.max(t.totalPages||0,j.length)-1,className:"p-2 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Page",children:r.jsx(c.Z,{className:"w-5 h-5"})})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[t.isPdf&&getGlobalPlaceholders().length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Global Fields (All Pages)"}),getGlobalPlaceholders().map(e=>(0,r.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:[e.placeholder||`${e.type} field`,e.required&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"}),r.jsx("span",{className:"ml-2 text-xs bg-blue-200 text-blue-700 px-2 py-1 rounded",children:"GLOBAL - All Pages"})]}),"text"===e.type?r.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value)}):"textarea"===e.type?r.jsx("textarea",{className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value),rows:e.maxLines||5,style:{lineHeight:e.lineHeight||1.2}}):(0,r.jsxs)("div",{children:[r.jsx("input",{type:"file",accept:"image/*",className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:t=>handleImageUpload(e.id,t.target.files?.[0]||null)}),g[e.id]&&g[e.id]instanceof File&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-green-600",children:["Selected: ",g[e.id].name]})]})]},e.id))]}),r.jsx("h3",{className:"text-md font-medium text-gray-800",children:t.isPdf?`Page ${w+1} Specific Fields`:"Template Fields"}),getPageSpecificPlaceholders().map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.placeholder||`${e.type} field`,e.required&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"}),t.isPdf&&(0,r.jsxs)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-600 px-1 rounded",children:["Page ",(e.pageIndex||0)+1]})]}),"text"===e.type?r.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value)}):"textarea"===e.type?r.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value),rows:e.maxLines||5,style:{lineHeight:e.lineHeight||1.2}}):(0,r.jsxs)("div",{children:[r.jsx("input",{type:"file",accept:"image/*",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:t=>handleImageUpload(e.id,t.target.files?.[0]||null)}),g[e.id]&&g[e.id]instanceof File&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-green-600",children:["Selected: ",g[e.id].name]})]})]},e.id)),0===getPageSpecificPlaceholders().length&&r.jsx("p",{className:"text-gray-500 text-sm italic",children:"No page-specific fields on this page"})]})]}),t.isPdf&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"All Template Fields"}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.placeholders.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm p-2 bg-gray-50 rounded",children:[r.jsx("span",{className:"font-medium",children:e.placeholder||`${e.type} field`}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-600 px-1 rounded",children:["P",(e.pageIndex||0)+1]}),r.jsx("span",{className:`w-2 h-2 rounded-full ${g[e.id]?"bg-green-500":"bg-gray-300"}`})]})]},e.id))})]})]}),r.jsx("div",{className:"lg:col-span-2",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Preview"}),t.isPdf&&(j.length>1||t.totalPages&&t.totalPages>1)&&(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>navigateToPage("prev"),disabled:0===w,className:"p-2 rounded-md bg-blue-100 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous Page",children:r.jsx(o.Z,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"number",min:"1",max:Math.max(t.totalPages||0,j.length),value:w+1,onChange:e=>goToPage(parseInt(e.target.value)||1),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["of ",Math.max(t.totalPages||0,j.length)]})]}),r.jsx("button",{onClick:()=>navigateToPage("next"),disabled:w>=Math.max(t.totalPages||0,j.length)-1,className:"p-2 rounded-md bg-blue-100 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next Page",children:r.jsx(c.Z,{className:"w-5 h-5 text-blue-600"})})]})]}),r.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden bg-white",children:r.jsx("div",{className:"flex justify-center items-center min-h-[400px] p-4",children:r.jsx("div",{ref:L,className:"relative shadow-lg",style:{width:t.isPdf?"fit-content":Math.min(t.width||800,800),height:t.isPdf?"fit-content":Math.min(t.height||600,600),maxWidth:"100%",maxHeight:"80vh",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px"},children:D?r.jsx("div",{className:"w-full h-96 flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading PDF pages..."})]})}):T?r.jsx("div",{className:"w-full h-96 flex items-center justify-center bg-red-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-600 mb-4",children:T}),r.jsx("button",{onClick:()=>t?.pdfFilePath&&loadPdfTemplate(t.pdfFilePath),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):getCurrentBackgroundImage()?(0,r.jsxs)(r.Fragment,{children:[t.isPdf?getCurrentBackgroundImage()?r.jsx("img",{src:getCurrentBackgroundImage(),alt:`PDF page ${w+1}`,className:"w-full h-auto object-contain",crossOrigin:"anonymous",onError:e=>{console.error("Error loading PDF page:",e),S(`Failed to load page ${w+1}`)},onLoad:()=>console.log(`PDF page ${w+1} loaded successfully`),style:{display:"block",maxWidth:"100%",maxHeight:"70vh",height:"auto",width:"auto"}}):r.jsx("div",{className:"w-full h-96 flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-gray-600 mb-2",children:["Page ",w+1," failed to render"]}),r.jsx("button",{onClick:()=>t?.pdfFilePath&&loadPdfTemplate(t.pdfFilePath),className:"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Retry"})]})}):r.jsx("img",{src:getCurrentBackgroundImage(),alt:"Template background",className:"w-full h-full object-contain",crossOrigin:"anonymous",onError:e=>console.error("Error loading image:",e),style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}),getCurrentPagePlaceholders().map(e=>{let a=g[e.id],l={...e};if(e.isGlobal&&e.pageOverrides&&e.pageOverrides[w]){let t=e.pageOverrides[w];l={...e,...t}}let s=L.current?.querySelector("img"),i=l.x,n=l.y,d=l.width,o=l.height;if(s){let e=s.getBoundingClientRect(),a=L.current?.getBoundingClientRect();if(a&&t.width&&t.height){let a=e.width/t.width,r=e.height/t.height;i=l.x*a,n=l.y*r,d=l.width*a,o=l.height*r}}return r.jsx("div",{className:"absolute flex items-center justify-center print:border-none print:bg-transparent",style:{left:i,top:n,width:d,height:o,pointerEvents:"none",border:"2px dashed #60a5fa",backgroundColor:"rgba(219, 234, 254, 0.3)"},"data-placeholder-border":"true",children:"text"===l.type?r.jsx("div",{className:"w-full h-full flex items-center justify-center text-center break-words overflow-hidden",style:{fontSize:l.fontSize||16,fontFamily:l.fontFamily||"Arial",color:l.color||"#000000",lineHeight:"1.2",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",wordWrap:"break-word",hyphens:"auto"},children:r.jsx("span",{style:{display:"block",width:"100%",textAlign:"center"},children:("string"==typeof a?a:"")||l.placeholder})}):"textarea"===l.type?r.jsx("div",{className:"w-full h-full text-center break-words overflow-hidden",style:{fontSize:l.fontSize||16,fontFamily:l.fontFamily||"Arial",color:l.color||"#000000",lineHeight:l.lineHeight||1.2,padding:"8px",display:"flex",alignItems:"flex-start",justifyContent:"center",textAlign:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:r.jsx("span",{style:{display:"block",width:"100%",textAlign:"center"},children:("string"==typeof a?a:"")||l.placeholder})}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100 rounded",children:a&&a instanceof File?r.jsx("img",{src:URL.createObjectURL(a),alt:"User uploaded",className:"w-full h-full object-contain",style:{objectFit:"contain",width:"100%",height:"100%"},onError:e=>console.error("Error loading uploaded image:",e)}):r.jsx("span",{className:"text-gray-500 text-xs text-center p-1",children:l.placeholder||"Upload Image"})})},e.id)})]}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:r.jsx("span",{className:"text-gray-500",children:"Loading template..."})})})})}),t.isPdf&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("span",{className:"font-medium text-gray-700",children:["Fields on this page: ",getCurrentPagePlaceholders().length]}),(0,r.jsxs)("span",{className:"text-gray-500",children:["Completed: ",getCurrentPagePlaceholders().filter(e=>g[e.id]).length," / ",getCurrentPagePlaceholders().length]})]}),r.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${getCurrentPagePlaceholders().length>0?getCurrentPagePlaceholders().filter(e=>g[e.id]).length/getCurrentPagePlaceholders().length*100:0}%`}})})]})]})})]})]})}):r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-600 mb-4",children:"Template not found"}),r.jsx(h(),{href:"/",className:"text-blue-600 hover:text-blue-800",children:"Back to Templates"})]})})}},5438:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>s,default:()=>d});var r=a(5153);let l=(0,r.createProxy)(String.raw`C:\Users\prana\CascadeProjects\template-creator\app\customize\[id]\page.tsx`),{__esModule:s,$$typeof:i}=l,n=l.default,d=n}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[862,607,440,590,139,283],()=>__webpack_exec__(9489));module.exports=a})();