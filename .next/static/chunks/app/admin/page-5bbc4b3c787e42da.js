(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2924:function(e,a,t){Promise.resolve().then(t.bind(t,5970))},5970:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return AdminPage}});var r=t(7437),l=t(2265),s=t(6637),d=t(1541),i=t(4266),n=t(8438),o=t(6245),c=t(1291),u=t(7158),m=t(5367),h=t(5020);function AdminPage(){let[e,a]=(0,l.useState)({name:"",description:"",category:"",backgroundImage:"",width:800,height:600,placeholders:[],isPdf:!1,totalPages:1}),[t,g]=(0,l.useState)(null),[x,p]=(0,l.useState)(null),[b,f]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[v,w]=(0,l.useState)(0),[N,P]=(0,l.useState)(null),[k,C]=(0,l.useState)([]),I=(0,l.useRef)(null),[F,D]=(0,l.useState)(null);(0,l.useEffect)(()=>{let loadPdfLib=async()=>{try{let e=document.createElement("script");e.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",e.onload=()=>{D(window.PDFLib)},document.head.appendChild(e);let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",document.head.appendChild(a)}catch(e){console.error("Error loading pdf libraries:",e)}};loadPdfLib()},[]);let renderPdfPage=async(e,a)=>{if(!F)return"";try{if(window.pdfjsLib){let t=await e.save(),r=window.pdfjsLib.getDocument({data:t}),l=await r.promise,s=await l.getPage(a+1),d=s.getViewport({scale:1.5}),i=document.createElement("canvas"),n=i.getContext("2d");return i.height=d.height,i.width=d.width,await s.render({canvasContext:n,viewport:d}).promise,i.toDataURL()}{let t=await F.PDFDocument.create(),[r]=await t.copyPages(e,[a]);t.addPage(r);let l=await t.save(),s=new Blob([l],{type:"application/pdf"});return URL.createObjectURL(s)}}catch(e){return console.error("Error rendering PDF page:",e),""}},processPdfFile=async e=>{if(F)try{let t=await e.arrayBuffer(),r=await F.PDFDocument.load(t),l=r.getPageCount(),s=r.getPage(0),{width:d,height:i}=s.getSize();P(r),a(e=>({...e,isPdf:!0,totalPages:l,width:d,height:i}));let n=[];for(let e=0;e<l;e++){let a=await renderPdfPage(r,e);n.push(a)}C(n),w(0)}catch(e){console.error("Error processing PDF:",e),alert("Error processing PDF file")}},S=(0,l.useCallback)(async e=>{let t=e[0];if(t){if(y(t),"application/pdf"===t.type)await processPdfFile(t);else{let e=URL.createObjectURL(t),r=new Image;r.onload=()=>{a(a=>({...a,backgroundImage:e,width:r.width,height:r.height,isPdf:!1,totalPages:1}))},r.src=e}}},[F]),{getRootProps:T,getInputProps:L,isDragActive:R}=(0,h.uI)({onDrop:S,accept:{"image/*":[".png",".jpg",".jpeg",".gif"],"application/pdf":[".pdf"]},multiple:!1}),updatePlaceholder=(e,t)=>{a(a=>({...a,placeholders:a.placeholders.map(a=>a.id===e?{...a,...t}:a)}))},deletePlaceholder=e=>{a(a=>({...a,placeholders:a.placeholders.filter(a=>a.id!==e)})),g(null)},generatePageOverrides=(e,a)=>{let t={};for(let r=0;r<a;r++)t[r]={x:e.x,y:e.y,width:e.width,height:e.height};return t},handlePlaceholderMouseDown=(e,a)=>{e.stopPropagation(),f(a),g(a)},navigateToPage=a=>{"prev"===a&&v>0?w(v-1):"next"===a&&v<(e.totalPages||1)-1&&w(v+1)},saveTemplate=async()=>{try{let t=new FormData;j&&t.append("file",j),t.append("template",JSON.stringify(e));let r=await fetch("/api/templates",{method:"POST",body:t});r.ok&&(alert("Template saved successfully!"),a({name:"",description:"",category:"",backgroundImage:"",width:800,height:600,placeholders:[],isPdf:!1,totalPages:1}),y(null),P(null),C([]),w(0))}catch(e){console.error("Error saving template:",e),alert("Error saving template")}},B=e.placeholders.filter(a=>!e.isPdf||a.pageIndex===v||a.isGlobal),E=e.placeholders.find(e=>e.id===t),getCurrentBackgroundImage=()=>e.isPdf&&k[v]?k[v]:e.backgroundImage;return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Template Admin"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Create and manage templates with interactive placeholders. Now supports PDFs with page navigation!"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white text-black rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Template Details"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:e.name,onChange:e=>a(a=>({...a,name:e.target.value})),placeholder:"Template name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,r.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,value:e.description,onChange:e=>a(a=>({...a,description:e.target.value})),placeholder:"Template description"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-black mb-1",children:"Category"}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:e.category,onChange:e=>a(a=>({...a,category:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"Select category"}),(0,r.jsx)("option",{value:"Certificate",children:"Certificate"}),(0,r.jsx)("option",{value:"Business Card",children:"Business Card"}),(0,r.jsx)("option",{value:"Flyer",children:"Flyer"}),(0,r.jsx)("option",{value:"Poster",children:"Poster"}),(0,r.jsx)("option",{value:"Invoice",children:"Invoice"}),(0,r.jsx)("option",{value:"Resume",children:"Resume"})]})]}),e.isPdf&&(0,r.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md",children:[(0,r.jsxs)("div",{className:"flex items-center text-blue-700",children:[(0,r.jsx)(s.Z,{className:"w-4 h-4 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"PDF Template"})]}),(0,r.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:[e.totalPages," pages â€¢ Current: Page ",v+1]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Upload Background"}),(0,r.jsxs)("div",{...T(),className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(R?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,r.jsx)("input",{...L()}),(0,r.jsx)(d.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:R?"Drop the file here":"Drag & drop PDF or image, or click to select"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Supports: PNG, JPG, PDF"})]}),j&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-green-600",children:["Uploaded: ",j.name]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Add Placeholders"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("button",{onClick:()=>p("text"),className:"w-full flex items-center justify-center px-4 py-2 rounded-md transition-colors ".concat("text"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Add Text Placeholder"]}),(0,r.jsxs)("button",{onClick:()=>p("image"),className:"w-full flex items-center justify-center px-4 py-2 rounded-md transition-colors ".concat("image"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 mr-2"}),"Add Image Placeholder"]}),(0,r.jsxs)("button",{onClick:()=>p("textarea"),className:"w-full flex items-center justify-center px-4 py-2 rounded-md transition-colors ".concat("textarea"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(s.Z,{className:"w-4 h-4 mr-2"}),"Add Textarea Placeholder"]})]}),x&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-blue-600",children:["Click on the canvas to place the ",x," placeholder",e.isPdf&&" on page ".concat(v+1)]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("button",{onClick:saveTemplate,className:"w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center justify-center",disabled:!e.name||!e.backgroundImage&&0===k.length,children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"Save Template"]})})})]}),(0,r.jsxs)("div",{className:"lg:col-span-2",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Template Canvas"}),e.isPdf&&e.totalPages>1&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>navigateToPage("prev"),disabled:0===v,className:"p-2 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(c.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",v+1," of ",e.totalPages]}),(0,r.jsx)("button",{onClick:()=>navigateToPage("next"),disabled:v===e.totalPages-1,className:"p-2 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(u.Z,{className:"w-4 h-4"})})]})]}),getCurrentBackgroundImage()?(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg overflow-hidden bg-white",children:(0,r.jsx)("div",{className:"flex justify-center items-center min-h-[500px] p-4",children:(0,r.jsxs)("div",{ref:I,className:"relative cursor-crosshair shadow-lg border border-gray-200 rounded-lg",style:{width:"fit-content",height:"fit-content",maxWidth:"100%",maxHeight:"80vh",backgroundColor:"#ffffff"},onClick:t=>{var r;if(!x)return;let l=null===(r=I.current)||void 0===r?void 0:r.getBoundingClientRect();if(!l)return;let s=I.current.querySelector("img, embed");if(!s)return;let d=s.getBoundingClientRect(),i=e.width/d.width,n=e.height/d.height,o=(t.clientX-d.left)*i,c=(t.clientY-d.top)*n,u={id:"placeholder-".concat(Date.now()),type:x,x:o,y:c,width:"text"===x?200:"textarea"===x?300:150,height:"text"===x?30:"textarea"===x?120:100,fontSize:16,fontFamily:"Arial",color:"#000000",placeholder:"text"===x?"Enter text here":"textarea"===x?"Enter paragraph text here":"Upload image",required:!0,pageIndex:e.isPdf?v:0,lineHeight:"textarea"===x?1.2:void 0,maxLines:"textarea"===x?5:void 0,isGlobal:!1,pageOverrides:{}};a(e=>({...e,placeholders:[...e.placeholders,u]})),p(null)},onMouseMove:a=>{var t;if(!b)return;let r=null===(t=I.current)||void 0===t?void 0:t.getBoundingClientRect();if(!r)return;let l=I.current.querySelector("img, embed");if(!l)return;let s=l.getBoundingClientRect(),d=e.width/s.width,i=e.height/s.height,n=(a.clientX-s.left)*d,o=(a.clientY-s.top)*i;updatePlaceholder(b,{x:n,y:o})},onMouseUp:()=>{f(null)},children:[window.pdfjsLib&&e.isPdf?(0,r.jsx)("img",{src:getCurrentBackgroundImage(),alt:"PDF page",className:"w-full h-auto object-contain",draggable:!1,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto",width:"auto"}}):e.isPdf?(0,r.jsx)("embed",{src:getCurrentBackgroundImage(),className:"w-full h-auto object-contain",type:"application/pdf",style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}):(0,r.jsx)("img",{src:getCurrentBackgroundImage(),alt:"Template background",className:"w-full h-auto object-contain",draggable:!1,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}),B.map(a=>{var l,d;let o=null===(l=I.current)||void 0===l?void 0:l.querySelector("img, embed"),c=a.x,u=a.y,m=a.width,h=a.height;if(o){let t=o.getBoundingClientRect(),r=null===(d=I.current)||void 0===d?void 0:d.getBoundingClientRect();if(r){let r=t.width/e.width,l=t.height/e.height;c=a.x*r,u=a.y*l,m=a.width*r,h=a.height*l}}return(0,r.jsxs)("div",{className:"absolute border-2 cursor-move ".concat(t===a.id?"border-blue-500 bg-blue-100":"border-red-400 bg-red-100"," bg-opacity-50 flex items-center justify-center text-xs font-medium"),style:{left:c,top:u,width:m,height:h},onMouseDown:e=>handlePlaceholderMouseDown(e,a.id),children:["text"===a.type?(0,r.jsx)(i.Z,{className:"w-4 h-4"}):"textarea"===a.type?(0,r.jsx)(s.Z,{className:"w-4 h-4"}):(0,r.jsx)(n.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"ml-1",children:a.type}),e.isPdf&&(0,r.jsx)("span",{className:"ml-1 text-xs bg-gray-200 px-1 rounded",children:a.isGlobal?"ALL":"P".concat((a.pageIndex||0)+1)})]},a.id)})]})})}):(0,r.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg h-96 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Upload a background image or PDF to start"})]})})]}),E&&(0,r.jsxs)("div",{className:"mt-6 bg-white text-black rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Placeholder Properties"}),(0,r.jsx)("button",{onClick:()=>deletePlaceholder(E.id),className:"text-red-600 hover:text-red-800 p-1",children:(0,r.jsx)(m.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"X Position"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.x,onChange:e=>updatePlaceholder(E.id,{x:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Y Position"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.y,onChange:e=>updatePlaceholder(E.id,{y:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Width"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.width,onChange:e=>updatePlaceholder(E.id,{width:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.height,onChange:e=>updatePlaceholder(E.id,{height:parseInt(e.target.value)})})]}),e.isPdf&&(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Page"}),(0,r.jsx)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.pageIndex||0,onChange:e=>updatePlaceholder(E.id,{pageIndex:parseInt(e.target.value)}),children:Array.from({length:e.totalPages||1},(e,a)=>(0,r.jsxs)("option",{value:a,children:["Page ",a+1]},a))})]}),("text"===E.type||"textarea"===E.type)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Size"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.fontSize,onChange:e=>updatePlaceholder(E.id,{fontSize:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Family"}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.fontFamily,onChange:e=>updatePlaceholder(E.id,{fontFamily:e.target.value}),children:[(0,r.jsx)("option",{value:"Arial",children:"Arial"}),(0,r.jsx)("option",{value:"Helvetica",children:"Helvetica"}),(0,r.jsx)("option",{value:"Times New Roman",children:"Times New Roman"}),(0,r.jsx)("option",{value:"Georgia",children:"Georgia"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),(0,r.jsx)("input",{type:"color",className:"w-full h-10 border border-gray-300 rounded-md",value:E.color,onChange:e=>updatePlaceholder(E.id,{color:e.target.value})})]}),"textarea"===E.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Line Height"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"1",max:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.lineHeight||1.2,onChange:e=>updatePlaceholder(E.id,{lineHeight:parseFloat(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Lines"}),(0,r.jsx)("input",{type:"number",min:"1",max:"20",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.maxLines||5,onChange:e=>updatePlaceholder(E.id,{maxLines:parseInt(e.target.value)})})]})]})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Placeholder Text"}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:E.placeholder,onChange:e=>updatePlaceholder(E.id,{placeholder:e.target.value})})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsxs)("label",{className:"flex items-center mb-2",children:[(0,r.jsx)("input",{type:"checkbox",className:"mr-2",checked:E.required,onChange:e=>updatePlaceholder(E.id,{required:e.target.checked})}),"Required field"]}),e.isPdf&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",className:"mr-2",checked:E.isGlobal||!1,onChange:a=>{let t=a.target.checked;updatePlaceholder(E.id,{isGlobal:t,pageOverrides:t?generatePageOverrides(E,e.totalPages||1):{}})}}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Global placeholder (appears on all pages with same coordinates)"})]}),E.isGlobal&&(0,r.jsxs)("div",{className:"bg-blue-50 p-2 rounded text-xs text-blue-700",children:[(0,r.jsx)("strong",{children:"Global Mode:"})," This placeholder will appear at the same position (X: ",E.x,", Y: ",E.y,") on all ",e.totalPages," pages."]})]})]})]})]})]})]})]})})}}},function(e){e.O(0,[458,971,472,744],function(){return e(e.s=2924)}),_N_E=e.O()}]);