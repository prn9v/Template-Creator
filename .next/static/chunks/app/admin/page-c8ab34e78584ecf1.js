(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2924:function(e,t,a){Promise.resolve().then(a.bind(a,5970))},5970:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AdminPage}});var r=a(7437),l=a(2265),s=a(6637),d=a(1541),i=a(4266),n=a(8438),o=a(6245),c=a(1291),u=a(7158),m=a(5367),h=a(5020);function AdminPage(){let[e,t]=(0,l.useState)({name:"",description:"",category:"",backgroundImage:"",width:800,height:600,placeholders:[],isPdf:!1,totalPages:1}),[a,g]=(0,l.useState)(null),[p,x]=(0,l.useState)(null),[b,f]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[v,w]=(0,l.useState)(0),[N,P]=(0,l.useState)(null),[C,k]=(0,l.useState)([]),I=(0,l.useRef)(null),[D,F]=(0,l.useState)(null);(0,l.useEffect)(()=>{let loadPdfLib=async()=>{try{let e=document.createElement("script");e.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",e.onload=()=>{F(window.PDFLib)},document.head.appendChild(e);let t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",document.head.appendChild(t)}catch(e){console.error("Error loading pdf libraries:",e)}};loadPdfLib()},[]);let renderPdfPage=async(e,t)=>{if(!D)return"";try{if(window.pdfjsLib){let a=await e.save(),r=window.pdfjsLib.getDocument({data:a}),l=await r.promise,s=await l.getPage(t+1),d=s.getViewport({scale:1.5}),i=document.createElement("canvas"),n=i.getContext("2d");return i.height=d.height,i.width=d.width,await s.render({canvasContext:n,viewport:d}).promise,i.toDataURL()}{let a=await D.PDFDocument.create(),[r]=await a.copyPages(e,[t]);a.addPage(r);let l=await a.save(),s=new Blob([l],{type:"application/pdf"});return URL.createObjectURL(s)}}catch(e){return console.error("Error rendering PDF page:",e),""}},processPdfFile=async e=>{if(D)try{let a=await e.arrayBuffer(),r=await D.PDFDocument.load(a),l=r.getPageCount(),s=r.getPage(0),{width:d,height:i}=s.getSize();P(r),t(e=>({...e,isPdf:!0,totalPages:l,width:d,height:i}));let n=[];for(let e=0;e<l;e++){let t=await renderPdfPage(r,e);n.push(t)}k(n),w(0)}catch(e){console.error("Error processing PDF:",e),alert("Error processing PDF file")}},S=(0,l.useCallback)(async e=>{let a=e[0];if(a){if(y(a),"application/pdf"===a.type)await processPdfFile(a);else{let e=URL.createObjectURL(a),r=new Image;r.onload=()=>{t(t=>({...t,backgroundImage:e,width:r.width,height:r.height,isPdf:!1,totalPages:1}))},r.src=e}}},[D]),{getRootProps:T,getInputProps:R,isDragActive:B}=(0,h.uI)({onDrop:S,accept:{"image/*":[".png",".jpg",".jpeg",".gif"],"application/pdf":[".pdf"]},multiple:!1}),updatePlaceholder=(e,a)=>{t(t=>({...t,placeholders:t.placeholders.map(t=>t.id===e?{...t,...a}:t)}))},deletePlaceholder=e=>{t(t=>({...t,placeholders:t.placeholders.filter(t=>t.id!==e)})),g(null)},handlePlaceholderMouseDown=(e,t)=>{e.stopPropagation(),f(t),g(t)},navigateToPage=t=>{"prev"===t&&v>0?w(v-1):"next"===t&&v<(e.totalPages||1)-1&&w(v+1)},saveTemplate=async()=>{try{let a=new FormData;j&&a.append("file",j),a.append("template",JSON.stringify(e));let r=await fetch("/api/templates",{method:"POST",body:a});r.ok&&(alert("Template saved successfully!"),t({name:"",description:"",category:"",backgroundImage:"",width:800,height:600,placeholders:[],isPdf:!1,totalPages:1}),y(null),P(null),k([]),w(0))}catch(e){console.error("Error saving template:",e),alert("Error saving template")}},E=e.placeholders.filter(t=>!e.isPdf||t.pageIndex===v),L=e.placeholders.find(e=>e.id===a),getCurrentBackgroundImage=()=>e.isPdf&&C[v]?C[v]:e.backgroundImage;return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Template Admin"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Create and manage templates with interactive placeholders. Now supports PDFs with page navigation!"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white text-black rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Template Details"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:e.name,onChange:e=>t(t=>({...t,name:e.target.value})),placeholder:"Template name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,r.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,value:e.description,onChange:e=>t(t=>({...t,description:e.target.value})),placeholder:"Template description"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-black mb-1",children:"Category"}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:e.category,onChange:e=>t(t=>({...t,category:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"Select category"}),(0,r.jsx)("option",{value:"Certificate",children:"Certificate"}),(0,r.jsx)("option",{value:"Business Card",children:"Business Card"}),(0,r.jsx)("option",{value:"Flyer",children:"Flyer"}),(0,r.jsx)("option",{value:"Poster",children:"Poster"}),(0,r.jsx)("option",{value:"Invoice",children:"Invoice"}),(0,r.jsx)("option",{value:"Resume",children:"Resume"})]})]}),e.isPdf&&(0,r.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md",children:[(0,r.jsxs)("div",{className:"flex items-center text-blue-700",children:[(0,r.jsx)(s.Z,{className:"w-4 h-4 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"PDF Template"})]}),(0,r.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:[e.totalPages," pages â€¢ Current: Page ",v+1]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Upload Background"}),(0,r.jsxs)("div",{...T(),className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(B?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,r.jsx)("input",{...R()}),(0,r.jsx)(d.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:B?"Drop the file here":"Drag & drop PDF or image, or click to select"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Supports: PNG, JPG, PDF"})]}),j&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-green-600",children:["Uploaded: ",j.name]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Add Placeholders"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("button",{onClick:()=>x("text"),className:"w-full flex items-center justify-center px-4 py-2 rounded-md transition-colors ".concat("text"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Add Text Placeholder"]}),(0,r.jsxs)("button",{onClick:()=>x("image"),className:"w-full flex items-center justify-center px-4 py-2 rounded-md transition-colors ".concat("image"===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 mr-2"}),"Add Image Placeholder"]})]}),p&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-blue-600",children:["Click on the canvas to place the ",p," placeholder",e.isPdf&&" on page ".concat(v+1)]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("button",{onClick:saveTemplate,className:"w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center justify-center",disabled:!e.name||!e.backgroundImage&&0===C.length,children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"Save Template"]})})})]}),(0,r.jsxs)("div",{className:"lg:col-span-2",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Template Canvas"}),e.isPdf&&e.totalPages>1&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>navigateToPage("prev"),disabled:0===v,className:"p-2 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(c.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",v+1," of ",e.totalPages]}),(0,r.jsx)("button",{onClick:()=>navigateToPage("next"),disabled:v===e.totalPages-1,className:"p-2 rounded-md bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(u.Z,{className:"w-4 h-4"})})]})]}),getCurrentBackgroundImage()?(0,r.jsx)("div",{className:"border border-gray-300 rounded-lg overflow-hidden bg-white",children:(0,r.jsx)("div",{className:"flex justify-center items-center min-h-[500px] p-4",children:(0,r.jsxs)("div",{ref:I,className:"relative cursor-crosshair shadow-lg border border-gray-200 rounded-lg",style:{width:"fit-content",height:"fit-content",maxWidth:"100%",maxHeight:"80vh",backgroundColor:"#ffffff"},onClick:a=>{var r;if(!p)return;let l=null===(r=I.current)||void 0===r?void 0:r.getBoundingClientRect();if(!l)return;let s=I.current.querySelector("img, embed");if(!s)return;let d=s.getBoundingClientRect(),i=e.width/d.width,n=e.height/d.height,o=(a.clientX-d.left)*i,c=(a.clientY-d.top)*n,u={id:"placeholder-".concat(Date.now()),type:p,x:o,y:c,width:"text"===p?200:150,height:"text"===p?30:100,fontSize:16,fontFamily:"Arial",color:"#000000",placeholder:"text"===p?"Enter text here":"Upload image",required:!0,pageIndex:e.isPdf?v:0};t(e=>({...e,placeholders:[...e.placeholders,u]})),x(null)},onMouseMove:t=>{var a;if(!b)return;let r=null===(a=I.current)||void 0===a?void 0:a.getBoundingClientRect();if(!r)return;let l=I.current.querySelector("img, embed");if(!l)return;let s=l.getBoundingClientRect(),d=e.width/s.width,i=e.height/s.height,n=(t.clientX-s.left)*d,o=(t.clientY-s.top)*i;updatePlaceholder(b,{x:n,y:o})},onMouseUp:()=>{f(null)},children:[window.pdfjsLib&&e.isPdf?(0,r.jsx)("img",{src:getCurrentBackgroundImage(),alt:"PDF page",className:"w-full h-auto object-contain",draggable:!1,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto",width:"auto"}}):e.isPdf?(0,r.jsx)("embed",{src:getCurrentBackgroundImage(),className:"w-full h-auto object-contain",type:"application/pdf",style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}):(0,r.jsx)("img",{src:getCurrentBackgroundImage(),alt:"Template background",className:"w-full h-auto object-contain",draggable:!1,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}),E.map(t=>{var l,s;let d=null===(l=I.current)||void 0===l?void 0:l.querySelector("img, embed"),o=t.x,c=t.y,u=t.width,m=t.height;if(d){let a=d.getBoundingClientRect(),r=null===(s=I.current)||void 0===s?void 0:s.getBoundingClientRect();if(r){let r=a.width/e.width,l=a.height/e.height;o=t.x*r,c=t.y*l,u=t.width*r,m=t.height*l}}return(0,r.jsxs)("div",{className:"absolute border-2 cursor-move ".concat(a===t.id?"border-blue-500 bg-blue-100":"border-red-400 bg-red-100"," bg-opacity-50 flex items-center justify-center text-xs font-medium"),style:{left:o,top:c,width:u,height:m},onMouseDown:e=>handlePlaceholderMouseDown(e,t.id),children:["text"===t.type?(0,r.jsx)(i.Z,{className:"w-4 h-4"}):(0,r.jsx)(n.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"ml-1",children:t.type}),e.isPdf&&(0,r.jsxs)("span",{className:"ml-1 text-xs bg-gray-200 px-1 rounded",children:["P",(t.pageIndex||0)+1]})]},t.id)})]})})}):(0,r.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg h-96 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Upload a background image or PDF to start"})]})})]}),L&&(0,r.jsxs)("div",{className:"mt-6 bg-white text-black rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Placeholder Properties"}),(0,r.jsx)("button",{onClick:()=>deletePlaceholder(L.id),className:"text-red-600 hover:text-red-800 p-1",children:(0,r.jsx)(m.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"X Position"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.x,onChange:e=>updatePlaceholder(L.id,{x:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Y Position"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.y,onChange:e=>updatePlaceholder(L.id,{y:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Width"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.width,onChange:e=>updatePlaceholder(L.id,{width:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.height,onChange:e=>updatePlaceholder(L.id,{height:parseInt(e.target.value)})})]}),e.isPdf&&(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Page"}),(0,r.jsx)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.pageIndex||0,onChange:e=>updatePlaceholder(L.id,{pageIndex:parseInt(e.target.value)}),children:Array.from({length:e.totalPages||1},(e,t)=>(0,r.jsxs)("option",{value:t,children:["Page ",t+1]},t))})]}),"text"===L.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Size"}),(0,r.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.fontSize,onChange:e=>updatePlaceholder(L.id,{fontSize:parseInt(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Family"}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.fontFamily,onChange:e=>updatePlaceholder(L.id,{fontFamily:e.target.value}),children:[(0,r.jsx)("option",{value:"Arial",children:"Arial"}),(0,r.jsx)("option",{value:"Helvetica",children:"Helvetica"}),(0,r.jsx)("option",{value:"Times New Roman",children:"Times New Roman"}),(0,r.jsx)("option",{value:"Georgia",children:"Georgia"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),(0,r.jsx)("input",{type:"color",className:"w-full h-10 border border-gray-300 rounded-md",value:L.color,onChange:e=>updatePlaceholder(L.id,{color:e.target.value})})]})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Placeholder Text"}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:L.placeholder,onChange:e=>updatePlaceholder(L.id,{placeholder:e.target.value})})]}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",className:"mr-2",checked:L.required,onChange:e=>updatePlaceholder(L.id,{required:e.target.checked})}),"Required field"]})})]})]})]})]})]})})}}},function(e){e.O(0,[458,971,472,744],function(){return e(e.s=2924)}),_N_E=e.O()}]);