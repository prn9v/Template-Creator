(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73],{5866:function(e,t,a){Promise.resolve().then(a.bind(a,5660))},5660:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return CustomizePage}});var l=a(7437),r=a(2265),s=a(4033),n=a(3067),i=a(6637),d=a(5817),o=a(1291),c=a(7158),g=a(1396),h=a.n(g),m=a(2692),u=a.n(m),p=a(930);function CustomizePage(){let e=(0,s.useParams)(),[t,a]=(0,r.useState)(null),[g,m]=(0,r.useState)({}),[f,x]=(0,r.useState)(!0),[b,y]=(0,r.useState)(!1),[w,j]=(0,r.useState)(0),[P,v]=(0,r.useState)([]),[N,C]=(0,r.useState)(null),[F,k]=(0,r.useState)(null),[D,E]=(0,r.useState)(!1),[T,S]=(0,r.useState)(null),L=(0,r.useRef)(null);(0,r.useEffect)(()=>{let loadPdfLibraries=async()=>{try{let e=document.createElement("script");e.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",e.onload=()=>{k(window.PDFLib)},document.head.appendChild(e);let t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",t.onload=()=>{window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"},document.head.appendChild(t)}catch(e){console.error("Error loading PDF libraries:",e)}};loadPdfLibraries()},[]),(0,r.useEffect)(()=>{e.id&&fetchTemplate(e.id)},[e.id]),(0,r.useEffect)(()=>{let handleKeyDown=e=>{(null==t?void 0:t.isPdf)&&("ArrowLeft"===e.key||"ArrowUp"===e.key?(e.preventDefault(),navigateToPage("prev")):("ArrowRight"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),navigateToPage("next")))};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[t,w]);let fetchTemplate=async e=>{try{x(!0);let t=await fetch("/api/templates/".concat(e));if(t.ok){let e=await t.json();a(e);let l={};e.placeholders.forEach(e=>{l[e.id]=""}),m(l),e.isPdf&&e.pdfFilePath?await loadPdfTemplate(e.pdfFilePath):e.isPdf&&!e.pdfFilePath&&(console.warn("PDF template detected but no pdfFilePath provided"),S("PDF file path not found in template data"))}else throw Error("Template not found")}catch(e){console.error("Error fetching template:",e)}finally{x(!1)}},loadPdfTemplate=async e=>{if(!F){console.warn("PDF-lib not loaded yet, retrying..."),setTimeout(()=>loadPdfTemplate(e),1e3);return}try{E(!0),S(null),console.log("Loading PDF from:",e);let l=await fetch(e,{mode:"cors",headers:{Accept:"application/pdf"}});if(!l.ok)throw Error("Failed to fetch PDF: ".concat(l.status," ").concat(l.statusText));let r=await l.arrayBuffer();console.log("PDF loaded, size:",r.byteLength);let s=await F.PDFDocument.load(r),n=s.getPageCount();console.log("PDF pages detected:",n),C(s),t&&(!t.totalPages||t.totalPages!==n)&&a(e=>e?{...e,totalPages:n}:null);let i=[];for(let e=0;e<n;e++)try{console.log("Rendering page ".concat(e+1,"/").concat(n));let t=await renderPdfPage(s,e);t?(i.push(t),console.log("Page ".concat(e+1," rendered successfully"))):(console.warn("Page ".concat(e+1," failed to render")),i.push(""))}catch(t){console.error("Error rendering page ".concat(e+1,":"),t),i.push("")}console.log("Total pages rendered:",i.filter(e=>e).length),v(i),j(0),E(!1)}catch(e){console.error("Error loading PDF template:",e),S("Failed to load PDF template: ".concat(e instanceof Error?e.message:"Unknown error")),E(!1)}},renderPdfPage=async(e,t)=>{if(!F||!e)return"";try{if(window.pdfjsLib||(console.warn("PDF.js not loaded, waiting..."),await new Promise(e=>setTimeout(e,1e3))),window.pdfjsLib){let a=await e.save(),l=window.pdfjsLib.getDocument({data:a,cMapUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/",cMapPacked:!0}),r=await l.promise,s=await r.getPage(t+1),n=Math.min(2,800/s.getViewport({scale:1}).width),i=s.getViewport({scale:n}),d=document.createElement("canvas"),o=d.getContext("2d");if(!o)throw Error("Canvas context not available");return d.height=i.height,d.width=i.width,await s.render({canvasContext:o,viewport:i,enableWebGL:!1}).promise,r.destroy(),d.toDataURL("image/png",.9)}{console.warn("PDF.js not available, using fallback");let a=await F.PDFDocument.create(),[l]=await a.copyPages(e,[t]);a.addPage(l);let r=await a.save(),s=new Blob([r],{type:"application/pdf"});return URL.createObjectURL(s)}}catch(e){return console.error("Error rendering PDF page:",e),""}},handleInputChange=(e,t)=>{m(a=>({...a,[e]:t}))},handleImageUpload=(e,t)=>{m(a=>({...a,[e]:t}))},navigateToPage=e=>{if(!t||!t.isPdf)return;let a=t.totalPages||P.length||1;"prev"===e&&w>0?j(w-1):"next"===e&&w<a-1&&j(w+1)},goToPage=e=>{if(!t||!t.isPdf)return;let a=t.totalPages||P.length||1;j(Math.max(0,Math.min(e-1,a-1)))},generatePDF=async()=>{if(t){y(!0);try{t.isPdf&&N?await generatePdfFromTemplate():await generatePdfFromCanvas()}catch(e){console.error("Error generating PDF:",e),alert("Error generating PDF. Please try again.")}finally{y(!1)}}},generatePdfFromTemplate=async()=>{if(F&&N&&t)try{let e=await F.PDFDocument.create(),a=await e.copyPages(N,Array.from({length:N.getPageCount()},(e,t)=>t));a.forEach(t=>e.addPage(t));let l=await e.embedFont(F.StandardFonts.Helvetica),r=await e.embedFont(F.StandardFonts.TimesRoman),s={Arial:l,Helvetica:l,"Times New Roman":r,Georgia:r},n=e.getPages(),i={};for(let a of t.placeholders)if("image"===a.type&&g[a.id]instanceof File){let t=g[a.id];try{let l;let r=await t.arrayBuffer();if("image/png"===t.type)l=await e.embedPng(r);else if("image/jpeg"===t.type||"image/jpg"===t.type)l=await e.embedJpg(r);else{console.warn("Unsupported image type: ".concat(t.type));continue}i[a.id]=l}catch(e){console.error("Error embedding image:",e)}}for(let e=0;e<n.length;e++){let a=n[e],r=t.placeholders.filter(t=>t.pageIndex===e||t.isGlobal);for(let t of r){let r={...t};if(t.isGlobal&&t.pageOverrides&&t.pageOverrides[e]){let a=t.pageOverrides[e];r={...t,...a}}let n=g[t.id];if(!n&&t.required){alert('Required field "'.concat(t.placeholder,'" is missing on page ').concat(e+1));return}if(n){if("text"===t.type||"textarea"===t.type){let e=s[t.fontFamily||"Arial"]||l,i=t.fontSize||12,d=hexToRgb(t.color||"#000000"),o=a.getSize(),c=o.height,g=r.x,h=c-r.y-r.height;if("textarea"===t.type){let l=n.toString().split("\n"),s=(t.lineHeight||1.2)*i,o=t.maxLines||5,c=h+t.height-s;for(let t=0;t<Math.min(l.length,o);t++){if(l[t].trim()){let s=r.width-16,n=e.widthOfTextAtSize(l[t],i),o=g+8+(s-Math.min(n,s))/2;a.drawText(l[t],{x:o,y:c,size:i,font:e,color:F.rgb(d.r/255,d.g/255,d.b/255),maxWidth:s})}c-=s}}else{let t=r.width-16,l=e.widthOfTextAtSize(n.toString(),i),s=g+8+(t-Math.min(l,t))/2;a.drawText(n.toString(),{x:s,y:h+4,size:i,font:e,color:F.rgb(d.r/255,d.g/255,d.b/255),maxWidth:t})}}else if("image"===t.type&&i[t.id]){let e=i[t.id],l=a.getSize();l.width;let s=l.height,n=r.x,d=s-r.y-r.height,o=e.scale(1),c=o.width/o.height,g=r.width/r.height,h=r.width,m=r.height,u=n,p=d;c>g?(m=r.width/c,p=d+(r.height-m)/2):(h=r.height*c,u=n+(r.width-h)/2),a.drawImage(e,{x:u,y:p,width:h,height:m})}}}}let d=await e.save(),o=new Blob([d],{type:"application/pdf"}),c=URL.createObjectURL(o),h=document.createElement("a");h.href=c,h.download="".concat(t.name,"-customized.pdf"),h.click(),URL.revokeObjectURL(c)}catch(e){throw console.error("Error generating PDF from template:",e),e}},generatePdfFromCanvas=async()=>{if(!L.current||!t)return;let e=L.current.querySelectorAll('[data-placeholder-border="true"]');e.forEach(e=>{e.style.border="none",e.style.backgroundColor="transparent"});let a=await u()(L.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});e.forEach(e=>{e.style.border="2px dashed #60a5fa",e.style.backgroundColor="rgba(219, 234, 254, 0.3)"});let l=a.toDataURL("image/png"),r=new p.ZP({orientation:t.width>t.height?"landscape":"portrait",unit:"px",format:[t.width,t.height]});r.addImage(l,"PNG",0,0,t.width,t.height),r.save("".concat(t.name,"-customized.pdf"))},downloadImage=async()=>{if(L.current){y(!0);try{let e=L.current.querySelectorAll('[data-placeholder-border="true"]');e.forEach(e=>{e.style.border="none",e.style.backgroundColor="transparent"});let a=await u()(L.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});e.forEach(e=>{e.style.border="2px dashed #60a5fa",e.style.backgroundColor="rgba(219, 234, 254, 0.3)"});let l=document.createElement("a");l.download="".concat(null==t?void 0:t.name,"-customized.png"),l.href=a.toDataURL(),l.click()}catch(e){console.error("Error generating image:",e),alert("Error generating image. Please try again.")}finally{y(!1)}}},hexToRgb=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},getCurrentPagePlaceholders=()=>t?t.isPdf?t.placeholders.filter(e=>e.pageIndex===w||e.isGlobal):t.placeholders:[],getGlobalPlaceholders=()=>t?t.placeholders.filter(e=>e.isGlobal):[],getPageSpecificPlaceholders=()=>t?t.isPdf?t.placeholders.filter(e=>e.pageIndex===w&&!e.isGlobal):t.placeholders.filter(e=>!e.isGlobal):[],getCurrentBackgroundImage=()=>(null==t?void 0:t.isPdf)&&P[w]?P[w]:(null==t?void 0:t.backgroundImage)||"";return f?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading template..."})]})}):t?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 text-black",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(h(),{href:"/",className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:(0,l.jsx)(n.Z,{className:"w-5 h-5"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mr-3",children:t.name}),t.isPdf&&(0,l.jsxs)("div",{className:"flex items-center bg-blue-50 px-2 py-1 rounded-md",children:[(0,l.jsx)(i.Z,{className:"w-4 h-4 text-blue-600 mr-1"}),(0,l.jsx)("span",{className:"text-sm text-blue-600",children:"PDF Template"})]})]}),(0,l.jsx)("p",{className:"text-gray-600",children:t.description}),t.isPdf&&(0,l.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:[Math.max(t.totalPages||0,P.length)," pages â€¢ Current: Page ",w+1]})]})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[!t.isPdf&&(0,l.jsxs)("button",{onClick:downloadImage,disabled:b,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50",children:[(0,l.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),b?"Generating...":"Download PNG"]}),(0,l.jsxs)("button",{onClick:generatePDF,disabled:b,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center disabled:opacity-50",children:[(0,l.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),b?"Generating...":"Download PDF"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Customize Your Template"}),t.isPdf&&(P.length>1||t.totalPages&&t.totalPages>1)&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Navigate Pages"}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("button",{onClick:()=>navigateToPage("prev"),disabled:0===w,className:"p-2 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Page",children:(0,l.jsx)(o.Z,{className:"w-5 h-5"})}),(0,l.jsxs)("span",{className:"text-sm text-gray-600 px-2",children:["Page ",w+1," of ",Math.max(t.totalPages||0,P.length)]}),(0,l.jsx)("button",{onClick:()=>navigateToPage("next"),disabled:w>=Math.max(t.totalPages||0,P.length)-1,className:"p-2 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Page",children:(0,l.jsx)(c.Z,{className:"w-5 h-5"})})]})]})}),(0,l.jsxs)("div",{className:"space-y-4",children:[t.isPdf&&getGlobalPlaceholders().length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Global Fields (All Pages)"}),getGlobalPlaceholders().map(e=>(0,l.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-blue-800 mb-1",children:[e.placeholder||"".concat(e.type," field"),e.required&&(0,l.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),(0,l.jsx)("span",{className:"ml-2 text-xs bg-blue-200 text-blue-700 px-2 py-1 rounded",children:"GLOBAL - All Pages"})]}),"text"===e.type?(0,l.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value)}):"textarea"===e.type?(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value),rows:e.maxLines||5,style:{lineHeight:e.lineHeight||1.2}}):(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{type:"file",accept:"image/*",className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:t=>{var a;return handleImageUpload(e.id,(null===(a=t.target.files)||void 0===a?void 0:a[0])||null)}}),g[e.id]&&g[e.id]instanceof File&&(0,l.jsxs)("p",{className:"mt-1 text-sm text-green-600",children:["Selected: ",g[e.id].name]})]})]},e.id))]}),(0,l.jsx)("h3",{className:"text-md font-medium text-gray-800",children:t.isPdf?"Page ".concat(w+1," Specific Fields"):"Template Fields"}),getPageSpecificPlaceholders().map(e=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.placeholder||"".concat(e.type," field"),e.required&&(0,l.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),t.isPdf&&(0,l.jsxs)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-600 px-1 rounded",children:["Page ",(e.pageIndex||0)+1]})]}),"text"===e.type?(0,l.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value)}):"textarea"===e.type?(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",placeholder:e.placeholder,value:g[e.id]||"",onChange:t=>handleInputChange(e.id,t.target.value),rows:e.maxLines||5,style:{lineHeight:e.lineHeight||1.2}}):(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{type:"file",accept:"image/*",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:t=>{var a;return handleImageUpload(e.id,(null===(a=t.target.files)||void 0===a?void 0:a[0])||null)}}),g[e.id]&&g[e.id]instanceof File&&(0,l.jsxs)("p",{className:"mt-1 text-sm text-green-600",children:["Selected: ",g[e.id].name]})]})]},e.id)),0===getPageSpecificPlaceholders().length&&(0,l.jsx)("p",{className:"text-gray-500 text-sm italic",children:"No page-specific fields on this page"})]})]}),t.isPdf&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"All Template Fields"}),(0,l.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.placeholders.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm p-2 bg-gray-50 rounded",children:[(0,l.jsx)("span",{className:"font-medium",children:e.placeholder||"".concat(e.type," field")}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-600 px-1 rounded",children:["P",(e.pageIndex||0)+1]}),(0,l.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(g[e.id]?"bg-green-500":"bg-gray-300")})]})]},e.id))})]})]}),(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Preview"}),t.isPdf&&(P.length>1||t.totalPages&&t.totalPages>1)&&(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("button",{onClick:()=>navigateToPage("prev"),disabled:0===w,className:"p-2 rounded-md bg-blue-100 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Previous Page",children:(0,l.jsx)(o.Z,{className:"w-5 h-5 text-blue-600"})}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"number",min:"1",max:Math.max(t.totalPages||0,P.length),value:w+1,onChange:e=>goToPage(parseInt(e.target.value)||1),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["of ",Math.max(t.totalPages||0,P.length)]})]}),(0,l.jsx)("button",{onClick:()=>navigateToPage("next"),disabled:w>=Math.max(t.totalPages||0,P.length)-1,className:"p-2 rounded-md bg-blue-100 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Next Page",children:(0,l.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"})})]})]}),(0,l.jsx)("div",{className:"border border-gray-300 rounded-lg overflow-hidden bg-white",children:(0,l.jsx)("div",{className:"flex justify-center items-center min-h-[400px] p-4",children:(0,l.jsx)("div",{ref:L,className:"relative shadow-lg",style:{width:t.isPdf?"fit-content":Math.min(t.width||800,800),height:t.isPdf?"fit-content":Math.min(t.height||600,600),maxWidth:"100%",maxHeight:"80vh",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px"},children:D?(0,l.jsx)("div",{className:"w-full h-96 flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading PDF pages..."})]})}):T?(0,l.jsx)("div",{className:"w-full h-96 flex items-center justify-center bg-red-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-red-600 mb-4",children:T}),(0,l.jsx)("button",{onClick:()=>(null==t?void 0:t.pdfFilePath)&&loadPdfTemplate(t.pdfFilePath),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):getCurrentBackgroundImage()?(0,l.jsxs)(l.Fragment,{children:[t.isPdf?getCurrentBackgroundImage()?(0,l.jsx)("img",{src:getCurrentBackgroundImage(),alt:"PDF page ".concat(w+1),className:"w-full h-auto object-contain",crossOrigin:"anonymous",onError:e=>{console.error("Error loading PDF page:",e),S("Failed to load page ".concat(w+1))},onLoad:()=>console.log("PDF page ".concat(w+1," loaded successfully")),style:{display:"block",maxWidth:"100%",maxHeight:"70vh",height:"auto",width:"auto"}}):(0,l.jsx)("div",{className:"w-full h-96 flex items-center justify-center bg-gray-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("p",{className:"text-gray-600 mb-2",children:["Page ",w+1," failed to render"]}),(0,l.jsx)("button",{onClick:()=>(null==t?void 0:t.pdfFilePath)&&loadPdfTemplate(t.pdfFilePath),className:"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Retry"})]})}):(0,l.jsx)("img",{src:getCurrentBackgroundImage(),alt:"Template background",className:"w-full h-full object-contain",crossOrigin:"anonymous",onError:e=>console.error("Error loading image:",e),style:{maxWidth:"100%",maxHeight:"70vh",height:"auto"}}),getCurrentPagePlaceholders().map(e=>{var a,r;let s=g[e.id],n={...e};if(e.isGlobal&&e.pageOverrides&&e.pageOverrides[w]){let t=e.pageOverrides[w];n={...e,...t}}let i=null===(a=L.current)||void 0===a?void 0:a.querySelector("img"),d=n.x,o=n.y,c=n.width,h=n.height;if(i){let e=i.getBoundingClientRect(),a=null===(r=L.current)||void 0===r?void 0:r.getBoundingClientRect();if(a&&t.width&&t.height){let a=e.width/t.width,l=e.height/t.height;d=n.x*a,o=n.y*l,c=n.width*a,h=n.height*l}}return(0,l.jsx)("div",{className:"absolute flex items-center justify-center print:border-none print:bg-transparent",style:{left:d,top:o,width:c,height:h,pointerEvents:"none",border:"2px dashed #60a5fa",backgroundColor:"rgba(219, 234, 254, 0.3)"},"data-placeholder-border":"true",children:"text"===n.type?(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center text-center break-words overflow-hidden",style:{fontSize:n.fontSize||16,fontFamily:n.fontFamily||"Arial",color:n.color||"#000000",lineHeight:"1.2",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",wordWrap:"break-word",hyphens:"auto"},children:(0,l.jsx)("span",{style:{display:"block",width:"100%",textAlign:"center"},children:("string"==typeof s?s:"")||n.placeholder})}):"textarea"===n.type?(0,l.jsx)("div",{className:"w-full h-full text-center break-words overflow-hidden",style:{fontSize:n.fontSize||16,fontFamily:n.fontFamily||"Arial",color:n.color||"#000000",lineHeight:n.lineHeight||1.2,padding:"8px",display:"flex",alignItems:"flex-start",justifyContent:"center",textAlign:"center",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,l.jsx)("span",{style:{display:"block",width:"100%",textAlign:"center"},children:("string"==typeof s?s:"")||n.placeholder})}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100 rounded",children:s&&s instanceof File?(0,l.jsx)("img",{src:URL.createObjectURL(s),alt:"User uploaded",className:"w-full h-full object-contain",style:{objectFit:"contain",width:"100%",height:"100%"},onError:e=>console.error("Error loading uploaded image:",e)}):(0,l.jsx)("span",{className:"text-gray-500 text-xs text-center p-1",children:n.placeholder||"Upload Image"})})},e.id)})]}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,l.jsx)("span",{className:"text-gray-500",children:"Loading template..."})})})})}),t.isPdf&&(0,l.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsxs)("span",{className:"font-medium text-gray-700",children:["Fields on this page: ",getCurrentPagePlaceholders().length]}),(0,l.jsxs)("span",{className:"text-gray-500",children:["Completed: ",getCurrentPagePlaceholders().filter(e=>g[e.id]).length," / ",getCurrentPagePlaceholders().length]})]}),(0,l.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(getCurrentPagePlaceholders().length>0?getCurrentPagePlaceholders().filter(e=>g[e.id]).length/getCurrentPagePlaceholders().length*100:0,"%")}})})]})]})})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"Template not found"}),(0,l.jsx)(h(),{href:"/",className:"text-blue-600 hover:text-blue-800",children:"Back to Templates"})]})})}}},function(e){e.O(0,[505,337,221,575,971,472,744],function(){return e(e.s=5866)}),_N_E=e.O()}]);